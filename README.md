## Dispatch Controllers

---


### Introduction

The application is a spring-boot project based on Java 11.
There are three entities exposed via REST APIs to control different functionalities, while some are managed by scheduled tasks.
See API Docs generated by the Open-API library - http://localhost:8088/task/swagger-ui.html

---
#### Prerequisites
- java 11
- Maven - where you get mvn command
- Recommendation(Optional) - run from an IntelliJ IDE or any spring boot supported IDE

#### Build

From the root folder of the project(dispatchcontrollers), from a command line, run
***mvn clean package***

#### Run

From the root folder of the project and command line, run ***java -jar target/dispatchcontrollers-0.0.1-SNAPSHOT.jar***
When run as-is, the application would be served on port 8088 like: ***localhost:8088/task***

Also, the H2 in-memory DB can be accessed via ***localhost:8088/task/h2-console*** with the following login details
- username: sa
- password: password

#### Tests 

The different endpoints to test scenarios can be accessed via this postman link - https://www.getpostman.com/collections/4e268c9594e375adaa30

- Create a **Drone** entity using the **post drone** request
- Update the **Drone** entity to a **LOADING** state using the **update drone** request
- Next, create a **Medication** entity using the **post medication** request
- Then, initiate the **Dispatch** through the **post dispatch** request
- Complete the **Dispatch** service using the **complete dispatch** request
- The other **GET** requests in the collections are for reading the details of the entities from our application.
- Please note that the scheduled tasks have been placed on a 20 seconds interval in order to quickly verify the results.

---

#### Drones (api/v1/drones)

This entity is used to manage drone creation, update and fetching.\
Upon creation, the initial state of the drone is set to IDLE and it can be updated.\
The update can be done by calling the update API.

#### Medications (api/v1/medications)

This entity is used to manage medication creation, update and fetching.\
The API request to create a new medication accepts a multi-part form-data in order to accommodate for the image file upload.
Upon successful creation, the image will be placed in a "medication-images" file path.

#### Dispatches (api/v1/dispatches)

This entity is used to manage dispatch creation, update and fetching.\
The Dispatch entity is responsible for loading and tracking the medication items loaded on a drone.\
A dispatch would only be successfully created if the drone is available for loading.

---

### Periodic Tasks

There are 3 task schedule implementation in the application

- ***checkDronesForBadState***: This is a periodic task to schedule updating drones that are in a bad state(batteryCapacity < 25 and state == LOADING)
- ***updateDronesToLoadingState***: This is a periodic task to update drones that are in a good state(IDLE state and batteryCapacity >= 25) to available state(LOADING state, weightOccupied=0)
- ***checkDroneBatteryLevel***: This is a periodic task to log the records of the drones in the system for audit purposes.